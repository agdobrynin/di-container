# ðŸ”‘ DiContainer c ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· PHP Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹

[Ð’ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°](https://github.com/agdobrynin/di-container/blob/main/docs/01-php-definition.md#ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ_dicontainer) Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ `useAttribute` Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½.

ÐŸÑ€Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¾Ð²Ð¼ÐµÑ‰Ð°Ñ‚ÑŒ php-Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹ Ð¸ php-Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ.

> âš  ÐŸÑ€Ð¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ Ð±Ð¾Ð»ÐµÐµ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¹
> Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð¸Ð¼ÐµÑŽÑ‚ php-Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹ Ñ‡ÐµÐ¼ php-Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ.

Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹:
- **[InjectContext](#injectcontext)** - Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð² Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€ Ð¸Ð»Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ ÐºÐ»Ð°ÑÑÐ° Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ ÐºÐ»Ð°ÑÑÐ° Ð¸Ð»Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð°.
- **[InjectByReference](#injectbyreference)** - Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¿Ð¾ ÑÑÑ‹Ð»ÐºÐµ Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ.
- **[Service](#service)** - Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° ÐºÐ°ÐºÐ¾Ð¹ ÐºÐ»Ð°ÑÑ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ð½ Ð¸ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ.
- **[ServiceByReference](#servicebyreference)** - Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð¿Ð¾ ÑÑÑ‹Ð»ÐºÐµ.
- **[DiFactory](#difactory)** - Ð¤Ð°Ð±Ñ€Ð¸ÐºÐ° Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹. ÐšÐ»Ð°ÑÑ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ `Kaspi\DiContainer\Interfaces\DiFactoryInterface`

## InjectContext

```php
use Kaspi\DiContainer\Attributes\InjectContext;

#[InjectContext(
    id: '', // ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ (ÐºÐ»Ð°ÑÑ, Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ).
            // ÐŸÑ€Ð¸ Ð¿ÑƒÑÑ‚Ð¾Ð¼ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ
            // Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¸ÑÑ…Ð¾Ð´Ñ Ð¸Ð· Ñ‚Ð¸Ð¿Ð° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð°.
            // Ð•ÑÐ»Ð¸ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ñƒ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð°
            // ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ
            // Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð¸Ð¼Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð° ÐºÐ°Ðº Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ.
    arguments: [], // ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€Ð° Ð´Ð»Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
                   // Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ Ð¿Ñ€Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸.
    isSingleton: false,  // Ð¡ÐµÑ€Ð²Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ ÐºÐ°Ðº Singleton.
)]
```

> ðŸ“ ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ "arguments" ÑÑ‚Ð¾ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹, Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼.
>
> ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ Ð² Ð¼Ð°ÑÑÐ¸Ð²Ðµ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¸Ð¼Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð² ÐºÐ»ÑŽÑ‡Ðµ Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¸ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°.
>   
> âš  Ð•ÑÐ»Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð° ÑÑ‚Ð¾ ÑÑ‚Ñ€Ð¾ÐºÐ° Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° "@" Ñ‚Ð¾ ÑÑ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð¾ ÐºÐ°Ðº ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ.
>
> ```php
> $arguments = [
>      // Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ ÑÑ‚Ñ€Ð¾ÐºÐ°
>      "paramNameOne" => "some value",
>      // ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ
>      // ÑÐ°Ð¼ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½ ÐºÐ°Ðº constant Ð² 
>      // Kaspi\DiContainer\Interfaces\Attributes\DiAttributeServiceInterface::IS_REFERENCE
>      "paramNameTwo" => "@identifier",
>      "paramNameAny" => ..., // any types sucha as array,
>                             // object and other available types.
> ];
> ```
> 

### ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÐºÐ»Ð°ÑÑÐ° Ð¸ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð² ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€Ðµ:

```php
// ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð°ÑÑÐ°
namespace App;

use Kaspi\DiContainer\Attributes\InjectContext;

class MyClass {
    public function __construct(
        #[InjectContext(
            arguments: [
                // âš  Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ "@" Ð² Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¸ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð°
                // ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð°
                // Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¾ ÑÑÑ‹Ð»ÐºÐµ.
                'dsn' => '@pdo_dsn',
            ],
            isSingleton: true 
        )]
        public \PDO $pdo
    ) {}
}
```

```php
// ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ DiContainer
use Kaspi\DiContainer\DiContainerFactory;

$definitions = ['pdo_dsn' => 'sqlite:/opt/databases/mydb.sq3'];

$container = (new DiContainerFactory())->make($definitions);
```

```php
// ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ²ÑÐ·Ñ‹Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
use App\MyClass;

/** @var MyClass $myClass */
$myClass = $container->get(MyClass::class);
$myClass->pdo->query('...')
```
### Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ **InjectLocal**:

```php
// ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð°ÑÑÐ°
namespace App;

use Kaspi\DiContainer\Attributes\InjectContext;

class MyUsers {
    public function __construct(public array $users) {}
}

class MyCompany {
    public function __construct(
        // Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚ id Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ Ð±ÑƒÐ´ÐµÑ‚ MyUsers
        #[InjectContext(arguments: ['users' => '@users_bosses'])]
        public MyUsers $bosses,
        #[InjectContext(arguments: ['users' => '@users_staffs'])]
        public MyUsers $staffs,
    ) {}
}
```

```php
// ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ DiContainer
use Kaspi\DiContainer\DiContainerFactory;

$definitions = [
    'users_bosses' => ['user1', 'user2'],
    'users_staffs' => ['user3', 'user3'],
];

$container = (new DiContainerFactory())->make($definitions);
```
```php
// ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ²ÑÐ·Ñ‹Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
use App\MyCompany;

/** @var MyCompany::class $company */
$company = $container->get(MyCompany::class);
print implode(',', $company->bosses->users); // user1, user2
print implode(',', $company->staffs->users); // user3, user4
```

### ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚ **#[InjectContext]** Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð´Ð»Ð¸Ð½Ñ‹

ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚ Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ñ€Ð¸Ð·Ð½Ð°Ðº `repetable`

```php
// ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ñ ÐºÐ»Ð°ÑÑÐ¾Ð²
namespace App\Rules;

use Kaspi\DiContainer\Attributes\InjectContext;

interface RuleInterface {}
class RuleA implements RuleInterface {}
class RuleB implements RuleInterface {}
class RuleC implements RuleInterface {}

class RuleGenerator {
    private iterable $rules;

    public function __construct(
        #[InjectContext(RuleB::class)]
        #[InjectContext(RuleA::class)]
        RuleInterface ...$inputRule
    ) {
        $this->rules = $inputRule;
    }
    
    public function getRules(): array {
        return $this->rules;
    }
}
```
```php
// Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
use Kaspi\DiContainer\Interfaces\DiContainerInterface;
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make();

// ... more code

$ruleGenerator = $container->get(App\Rules\RuleGenerator::class);
assert($ruleGenerator->getRules()[0] instanceof App\Rules\RuleB); // true
assert($ruleGenerator->getRules()[1] instanceof App\Rules\RuleA); // true
```

## **InjectByReference**

Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÑÑ‹Ð»ÐºÐµ Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ.

```php
use Kaspi\DiContainer\Attributes\InjectByReference;

#[InjectByReference(
    id: '', // Ð¸Ð¼Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ.
)]
```

ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚ Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ñ€Ð¸Ð·Ð½Ð°Ðº `repetable`

```php
// ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ñ ÐºÐ»Ð°ÑÑÐ¾Ð²
namespace App\Rules;

use Kaspi\DiContainer\Attributes\InjectByReference;

interface RuleInterface {}
class RuleA implements RuleInterface {}

class RuleGenerator {
    public function __construct(
        #[InjectByReference('service.rules.rule-a')] // Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÑÑ‹Ð»ÐºÐµ
        public RuleInterface $inputRule
    ) {}
}
```
```php
// Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
use Kaspi\DiContainer\Interfaces\DiContainerInterface;
use Kaspi\DiContainer\DiContainerFactory;

$definition = [
    'service.rules.rule-a' => diAutowire(App\Rules\RuleA::class),
];

$container = (new DiContainerFactory())->make($definition);

// ... more code

$ruleGenerator = $container->get(App\Rules\RuleGenerator::class);
assert($ruleGenerator->inputRule instanceof App\Rules\RuleA); // true
```


## Service

```php
use Kaspi\DiContainer\Attributes\Service;

#[Service(
    id: '', // ÐšÐ»Ð°ÑÑ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÑŽÑ‰Ð¸Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ.
            // ÐŸÑƒÑÑ‚Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ
            // Ñ‚Ð¸Ð¿ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð°.
    arguments: [], // ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€Ð° Ð´Ð»Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸.
    isSingleton: false,  // Ð¡ÐµÑ€Ð²Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ ÐºÐ°Ðº Singleton.
)]
```

```php
// ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð°ÑÑÐ¾Ð²
namespace App;

use Kaspi\DiContainer\Attributes\InjectByReference;use Kaspi\DiContainer\Attributes\InjectContext;
use Kaspi\DiContainer\Attributes\Service;

#[Service(CustomLogger::class)] // ÐºÐ»Ð°ÑÑ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÑŽÑ‰Ð¸Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ.
interface CustomLoggerInterface {
    public function loggerFile(): string;
}

// ....

class CustomLogger implements CustomLoggerInterface {
    public function __construct(
        #[InjectByReference('@logger_file')]
        protected string $file,
    ) {}
    
    public function loggerFile(): string {
        return $this->file;
    }
}

// ...

class MyLogger {
    public function __construct(
        // ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð½Ð°Ð¹Ð´Ñ‘Ñ‚ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
        // Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ Ñƒ Ð½ÐµÐ³Ð¾ php-Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ Service.
        public CustomLoggerInterface $customLogger
    ) {}
}
```

```php
// ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ DiContainer
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make(
    definitions: ['logger_file' => '/var/log/app.log']
);
```

```php
// ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ²ÑÐ·Ñ‹Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
use App\MyLogger;

/** @var MyLogger $myClass */
$myClass = $container->get(MyLogger::class);
print $myClass->customLogger->loggerFile(); // /var/log/app.log
```

## ServiceByReference

todo...

## DiFactory

```php
use Kaspi\DiContainer\Attributes\DiFactory;

#[DiFactory(
    id: '', // ÐšÐ»Ð°ÑÑ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÑŽÑ‰Ð¸Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Kaspi\DiContainer\Interfaces\DiFactoryInterface
    arguments: [], // Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€Ð° Ð´Ð»Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
    isSingleton: false,  // ÑÐµÑ€Ð²Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ ÐºÐ°Ðº Singleton
)]
```

```php
// ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð°ÑÑÐ°
namespace App;

#[Factory(App\Factory\FactorySuperClass::class)]
class SuperClass
{
    public function __construct(public string $name, public int $age) {}
}
```

```php
// Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð±Ñ€Ð¸ÐºÐ¸
namespace App\Factory;

use Kaspi\DiContainer\Interfaces\DiFactoryInterface;
use Psr\Container\ContainerInterface;

class FactorySuperClass implements DiFactoryInterface
{
    public function __invoke(ContainerInterface $container): App\SuperClass
    {
        return new App\SuperClass('Piter', 22);
    }
}
```

```php
// ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ²ÑÐ·Ñ‹Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
use App\SuperClass;

/** @var SuperClass $myClass */
$myClass = $container->get(SuperClass::class);
print $myClass->name; // Piter
print $myClass->age; // 22
```

### Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ #[DiFactory] Ð´Ð»Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²

Ð¢Ð°Ðº Ð¶Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ **Factory** Ð´Ð»Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€Ð° Ð¸Ð»Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð² ÐºÐ»Ð°ÑÑÐ°:

```php
// Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð°ÑÑÐ°
namespace App;

use Kaspi\DiContainer\Attributes\DiFactory;

class ClassWithFactoryArgument
{
    public function __construct(
        #[DiFactory(FactoryClassWithFactoryArgument::class)]
        public \ArrayIterator $arrayObject
    ) {}
}
```

```php
// Ð¤Ð°Ð±Ñ€Ð¸ÐºÐ° ÐºÐ»Ð°ÑÑÐ°
namespace App;

use Kaspi\DiContainer\Interfaces\DiFactoryInterface;
use Psr\Container\ContainerInterface;

class FactoryClassWithFactoryArgument implements DiFactoryInterface
{
    public function __invoke(ContainerInterface $container): \ArrayIterator
    {
        return new \ArrayIterator(
            $container->has('names') ? $container->get('names') : []
        );
    }
}
```

```php
// ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make(
    definitions: [
        'names' => ['Ivan', 'Piter', 'Vasiliy']
    ]
);
```

```php
// ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ²ÑÐ·Ñ‹Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
use App\ClassWithFactoryArgument;

/** @var ClassWithFactoryArgument $myClass */
$myClass = $container->get(ClassWithFactoryArgument::class);
$myClass->arrayObject->getArrayCopy(); // Ð¼Ð°ÑÑÐ¸Ð² ['Ivan', 'Piter', 'Vasiliy']
```

### ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚ #[DiFactory] Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð´Ð»Ð¸Ð½Ñ‹

ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚ Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ñ€Ð¸Ð·Ð½Ð°Ðº `repetable`

```php
// ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ñ ÐºÐ»Ð°ÑÑÐ¾Ð²
namespace App\Rules;

use Kaspi\DiContainer\Attributes\DiFactory;
use Kaspi\DiContainer\Interfaces\DiFactoryInterface;

interface RuleInterface {}

class RuleA implements RuleInterface {
    // some logic here
}

class RuleAFactory implements DiFactoryInterface {
    public function __invoke(ContainerInterface $container): RuleA {
        // some logic for creating class
        return new RuleA();
    }
}

class RuleB implements RuleInterface {
    // some logic here
}


class RuleBFactory implements DiFactoryInterface {
    public function __invoke(ContainerInterface $container): RuleB {
        // some logic for creating class
        return new RuleB();
    }
}

class RuleGenerator {
    private iterable $rules;

    public function __construct(
        #[DiFactory(RuleAFactory::class)]
        #[DiFactory(RuleBFactory::class)]
        RuleInterface ...$inputRule
    ) {
        $this->rules = $inputRule;
    }
    
    public function getRules(): array {
        return $this->rules;
    }
}
```
```php
// Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
use Kaspi\DiContainer\Interfaces\DiContainerInterface;
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make($definition);

// ... more code

$ruleGenerator = $container->get(App\Rules\RuleGenerator::class);
assert($ruleGenerator->getRules()[0] instanceof App\Rules\RuleA); // true
assert($ruleGenerator->getRules()[1] instanceof App\Rules\RuleB); // true
```
