# üîë DiContainer c –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ PHP –∞—Ç—Ä–∏–±—É—Ç—ã

[–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞](https://github.com/agdobrynin/di-container/blob/main/docs/01-php-definition.md#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ_dicontainer) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä `useAttribute` –≤–∫–ª—é—á—ë–Ω.

–ü—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–æ–∂–Ω–æ —Å–æ–≤–º–µ—â–∞—Ç—å php-–∞—Ç—Ä–∏–±—É—Ç—ã –∏ php-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

> ‚ö† –ü—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–π
> –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–º–µ—é—Ç php-–∞—Ç—Ä–∏–±—É—Ç—ã —á–µ–º php-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã:
- **[InjectContext](#injectcontext)** - –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–ª–∏ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–ª–∞—Å—Å–∞ –∏–ª–∏ –º–µ—Ç–æ–¥–∞.
- **[InjectByReference](#injectbyreference)** - –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ –¥—Ä—É–≥–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
- **[Service](#service)** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–∞–∫–æ–π –∫–ª–∞—Å—Å –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
- **[ServiceByReference](#servicebyreference)** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ —Å—Å—ã–ª–∫–µ.
- **[DiFactory](#difactory)** - –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Kaspi\DiContainer\Interfaces\DiFactoryInterface`

## InjectContext

```php
use Kaspi\DiContainer\Attributes\InjectContext;

#[InjectContext(
    id: '', // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫–ª–∞—Å—Å, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å).
            // –ü—Ä–∏ –ø—É—Å—Ç–æ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å
            // –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–∏–ø–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞.
            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –∞—Ä–≥—É–º–µ–Ω—Ç–∞
            // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
            // –ø–æ –∏–º–µ–Ω–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—è –∏–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
    arguments: [], // –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
                   // –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏.
    isSingleton: false,  // –°–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–∞–∫ Singleton.
)]
```

> üìù –ü–∞—Ä–∞–º–µ—Ç—Ä "arguments" —ç—Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
>
> –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –∫–ª—é—á–µ –∏ –∑–Ω–∞—á–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞.
>   
> ‚ö† –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–∏–º–≤–æ–ª–∞ "@" —Ç–æ —ç—Ç–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–∫ —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.
>
> ```php
> $arguments = [
>      // –ø–∞—Ä–∞–º–µ—Ç—Ä —Å—Ç—Ä–æ–∫–∞
>      "paramNameOne" => "some value",
>      // —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
>      // —Å–∞–º —Å–∏–º–≤–æ–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ constant –≤ 
>      // Kaspi\DiContainer\Interfaces\Attributes\DiAttributeServiceInterface::IS_REFERENCE
>      "paramNameTwo" => "@identifier",
>      "paramNameAny" => ..., // any types sucha as array,
>                             // object and other available types.
> ];
> ```
> 

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:

```php
// –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
namespace App;

use Kaspi\DiContainer\Attributes\InjectContext;

class MyClass {
    public function __construct(
        #[InjectContext(
            arguments: [
                // ‚ö† –ø—Ä–µ—Ñ–∏–∫—Å "@" –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
                // —É–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
                // –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ.
                'dsn' => '@pdo_dsn',
            ],
            isSingleton: true 
        )]
        public \PDO $pdo
    ) {}
}
```

```php
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è DiContainer
use Kaspi\DiContainer\DiContainerFactory;

$definitions = ['pdo_dsn' => 'sqlite:/opt/databases/mydb.sq3'];

$container = (new DiContainerFactory())->make($definitions);
```

```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
use App\MyClass;

/** @var MyClass $myClass */
$myClass = $container->get(MyClass::class);
$myClass->pdo->query('...')
```
### –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç **InjectLocal**:

```php
// –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
namespace App;

use Kaspi\DiContainer\Attributes\InjectContext;

class MyUsers {
    public function __construct(public array $users) {}
}

class MyCompany {
    public function __construct(
        // –∞—Ä–≥—É–º–µ–Ω—Ç id –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –±—É–¥–µ—Ç MyUsers
        #[InjectContext(arguments: ['users' => '@users_bosses'])]
        public MyUsers $bosses,
        #[InjectContext(arguments: ['users' => '@users_staffs'])]
        public MyUsers $staffs,
    ) {}
}
```

```php
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è DiContainer
use Kaspi\DiContainer\DiContainerFactory;

$definitions = [
    'users_bosses' => ['user1', 'user2'],
    'users_staffs' => ['user3', 'user3'],
];

$container = (new DiContainerFactory())->make($definitions);
```
```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
use App\MyCompany;

/** @var MyCompany::class $company */
$company = $container->get(MyCompany::class);
print implode(',', $company->bosses->users); // user1, user2
print implode(',', $company->staffs->users); // user3, user4
```

### –ê—Ç—Ä–∏–±—É—Ç **#[InjectContext]** –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã

–ê—Ç—Ä–∏–±—É—Ç –∏–º–µ–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫ `repetable`

```php
// –û–±—ä—è–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤
namespace App\Rules;

use Kaspi\DiContainer\Attributes\InjectContext;

interface RuleInterface {}
class RuleA implements RuleInterface {}
class RuleB implements RuleInterface {}
class RuleC implements RuleInterface {}

class RuleGenerator {
    private iterable $rules;

    public function __construct(
        #[InjectContext(RuleB::class)]
        #[InjectContext(RuleA::class)]
        RuleInterface ...$inputRule
    ) {
        $this->rules = $inputRule;
    }
    
    public function getRules(): array {
        return $this->rules;
    }
}
```
```php
// –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
use Kaspi\DiContainer\Interfaces\DiContainerInterface;
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make();

// ... more code

$ruleGenerator = $container->get(App\Rules\RuleGenerator::class);
assert($ruleGenerator->getRules()[0] instanceof App\Rules\RuleB); // true
assert($ruleGenerator->getRules()[1] instanceof App\Rules\RuleA); // true
```

## **InjectByReference**

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ –¥—Ä—É–≥–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

```php
use Kaspi\DiContainer\Attributes\InjectByReference;

#[InjectByReference(
    id: '', // –∏–º—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
)]
```

–ê—Ç—Ä–∏–±—É—Ç –∏–º–µ–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫ `repetable`

```php
// –û–±—ä—è–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤
namespace App\Rules;

use Kaspi\DiContainer\Attributes\InjectByReference;

interface RuleInterface {}
class RuleA implements RuleInterface {}

class RuleGenerator {
    public function __construct(
        #[InjectByReference('service.rules.rule-a')] // –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ
        public RuleInterface $inputRule
    ) {}
}
```
```php
// –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
use Kaspi\DiContainer\Interfaces\DiContainerInterface;
use Kaspi\DiContainer\DiContainerFactory;

$definition = [
    'service.rules.rule-a' => diAutowire(App\Rules\RuleA::class),
];

$container = (new DiContainerFactory())->make($definition);

// ... more code

$ruleGenerator = $container->get(App\Rules\RuleGenerator::class);
assert($ruleGenerator->inputRule instanceof App\Rules\RuleA); // true
```


## Service

```php
use Kaspi\DiContainer\Attributes\Service;

#[Service(
    id: '', // –ö–ª–∞—Å—Å —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
            // –ü—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
            // —Ç–∏–ø –∞—Ä–≥—É–º–µ–Ω—Ç–∞.
    arguments: [], // –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
    isSingleton: false,  // –°–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–∞–∫ Singleton.
)]
```

```php
// –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤
namespace App;

use Kaspi\DiContainer\Attributes\InjectByReference;use Kaspi\DiContainer\Attributes\InjectContext;
use Kaspi\DiContainer\Attributes\Service;

#[Service(CustomLogger::class)] // –∫–ª–∞—Å—Å —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
interface CustomLoggerInterface {
    public function loggerFile(): string;
}

// ....

class CustomLogger implements CustomLoggerInterface {
    public function __construct(
        #[InjectByReference('@logger_file')]
        protected string $file,
    ) {}
    
    public function loggerFile(): string {
        return $this->file;
    }
}

// ...

class MyLogger {
    public function __construct(
        // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–π–¥—ë—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        // –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —É –Ω–µ–≥–æ php-–∞—Ç—Ä–∏–±—É—Ç Service.
        public CustomLoggerInterface $customLogger
    ) {}
}
```

```php
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è DiContainer
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make(
    definitions: ['logger_file' => '/var/log/app.log']
);
```

```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
use App\MyLogger;

/** @var MyLogger $myClass */
$myClass = $container->get(MyLogger::class);
print $myClass->customLogger->loggerFile(); // /var/log/app.log
```

## ServiceByReference

todo...

## DiFactory

```php
use Kaspi\DiContainer\Attributes\DiFactory;

#[DiFactory(
    id: '', // –ö–ª–∞—Å—Å —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Kaspi\DiContainer\Interfaces\DiFactoryInterface
    arguments: [], // –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    isSingleton: false,  // —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–∞–∫ Singleton
)]
```

```php
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
namespace App;

#[Factory(App\Factory\FactorySuperClass::class)]
class SuperClass
{
    public function __construct(public string $name, public int $age) {}
}
```

```php
// –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏
namespace App\Factory;

use Kaspi\DiContainer\Interfaces\DiFactoryInterface;
use Psr\Container\ContainerInterface;

class FactorySuperClass implements DiFactoryInterface
{
    public function __invoke(ContainerInterface $container): App\SuperClass
    {
        return new App\SuperClass('Piter', 22);
    }
}
```

```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
use App\SuperClass;

/** @var SuperClass $myClass */
$myClass = $container->get(SuperClass::class);
print $myClass->name; // Piter
print $myClass->age; // 22
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ #[DiFactory] –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

–¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç **Factory** –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∏–ª–∏ –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–∞:

```php
// –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
namespace App;

use Kaspi\DiContainer\Attributes\DiFactory;

class ClassWithFactoryArgument
{
    public function __construct(
        #[DiFactory(FactoryClassWithFactoryArgument::class)]
        public \ArrayIterator $arrayObject
    ) {}
}
```

```php
// –§–∞–±—Ä–∏–∫–∞ –∫–ª–∞—Å—Å–∞
namespace App;

use Kaspi\DiContainer\Interfaces\DiFactoryInterface;
use Psr\Container\ContainerInterface;

class FactoryClassWithFactoryArgument implements DiFactoryInterface
{
    public function __invoke(ContainerInterface $container): \ArrayIterator
    {
        return new \ArrayIterator(
            $container->has('names') ? $container->get('names') : []
        );
    }
}
```

```php
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make(
    definitions: [
        'names' => ['Ivan', 'Piter', 'Vasiliy']
    ]
);
```

```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
use App\ClassWithFactoryArgument;

/** @var ClassWithFactoryArgument $myClass */
$myClass = $container->get(ClassWithFactoryArgument::class);
$myClass->arrayObject->getArrayCopy(); // –º–∞—Å—Å–∏–≤ ['Ivan', 'Piter', 'Vasiliy']
```

### –ê—Ç—Ä–∏–±—É—Ç #[DiFactory] –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã

–ê—Ç—Ä–∏–±—É—Ç –∏–º–µ–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫ `repetable`

```php
// –û–±—ä—è–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤
namespace App\Rules;

use Kaspi\DiContainer\Attributes\DiFactory;
use Kaspi\DiContainer\Interfaces\DiFactoryInterface;

interface RuleInterface {}

class RuleA implements RuleInterface {
    // some logic here
}

class RuleAFactory implements DiFactoryInterface {
    public function __invoke(ContainerInterface $container): RuleA {
        // some logic for creating class
        return new RuleA();
    }
}

class RuleB implements RuleInterface {
    // some logic here
}


class RuleBFactory implements DiFactoryInterface {
    public function __invoke(ContainerInterface $container): RuleB {
        // some logic for creating class
        return new RuleB();
    }
}

class RuleGenerator {
    private iterable $rules;

    public function __construct(
        #[DiFactory(RuleAFactory::class)]
        #[DiFactory(RuleBFactory::class)]
        RuleInterface ...$inputRule
    ) {
        $this->rules = $inputRule;
    }
    
    public function getRules(): array {
        return $this->rules;
    }
}
```
```php
// –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
use Kaspi\DiContainer\Interfaces\DiContainerInterface;
use Kaspi\DiContainer\DiContainerFactory;

$container = (new DiContainerFactory())->make($definition);

// ... more code

$ruleGenerator = $container->get(App\Rules\RuleGenerator::class);
assert($ruleGenerator->getRules()[0] instanceof App\Rules\RuleA); // true
assert($ruleGenerator->getRules()[1] instanceof App\Rules\RuleB); // true
```
