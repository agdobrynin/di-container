# üìÇ DefinitionsLoader
–°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (_dependency definitions_).
–¢–∞–∫ –∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω "–∏–º–ø–æ—Ä—Ç" –∫–ª–∞—Å—Å–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ PHP –∞—Ç—Ä–∏–±—É—Ç–æ–≤.

## –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

–ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã —Ä–µ–∂–∏–º—ã –∑–∞–≥—Ä—É–∑–∫–∏:
- —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

> [!WARNING]
> –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `return`
> –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª—é–±–æ–π –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–π –∏–ª–∏
> `\Closure` —Ç–∏–ø (_—Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞_).
> `\Closure` —Ç–∏–ø –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `\Generator` ‚Äì –≤–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `yield`.

### –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (_container identifiers_).
```php
Kaspi\DiContainer\DefinitionsLoader::load(
    string ...$file
)
```
–ê—Ä–≥—É–º–µ–Ω—Ç:
  - `$file` ‚Äì —Ñ–∞–π–ª(—ã) –æ–ø–∏—Å—ã–≤–∞—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
> [!WARNING]
> –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `Kaspi\DiContainer\Interfaces\Exceptions\ContainerAlreadyRegisteredExceptionInterface`
> –µ—Å–ª–∏ —Ä–∞–Ω–µ–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∂–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (_container identifier_).

### –ó–∞–º–µ–Ω—è—Ç—å —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∂–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
```php
Kaspi\DiContainer\DefinitionsLoader::loadOverride(
    string ...$file
)
```
–ê—Ä–≥—É–º–µ–Ω—Ç:
- `$file` ‚Äì —Ñ–∞–π–ª(—ã) –æ–ø–∏—Å—ã–≤–∞—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### –ö–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–∏–º–µ—Ä:
–§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:
- config/base_services.php
    ```php
    use function Kaspi\DiContainer\{diAutowire, diGet};
    
    // –ò—Å–ø–æ–ª—å–∑—É—é –º–∞—Å—Å–∏–≤ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
    return [
  
        diAutowire(App\Services\ReportMaker::class)
            ->bindArguments(
                mailFrom: 'admin.repost@example.com',
                storage: diGet(App\Storages\ReportStorage::class)
            ),
  
        // other services

    ];
    ```
- config/prod_services.php
    ```php
    use function Kaspi\DiContainer\diAutowire;
    
    // –ò—Å–ø–æ–ª—å–∑—É—é callback —Ñ—É–Ω–∫—Ü–∏—é –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
    return static function (): Generator {
  
        yield diAutowire(App\Storages\ReportStorage::class)
            ->bindArguments(dir: '/var/reports/');
    
        // ... many other services
        yield diAutowire(App\Services\ResportGenerator::class);
  
    };
    ```
- config/dev_services.php
    ```php
    use function Kaspi\DiContainer\diAutowire
    
    // –ò—Å–ø–æ–ª—å–∑—É—é callback —Ñ—É–Ω–∫—Ü–∏—é –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
    return static function (): Generator {
  
        yield diAutowire(App\Storages\ReportStorage::class)
            ->bindArguments(dir: sys_get_temp_dir())
        ;
  
        // ... many other services
  
    };
    ```
–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```php
use Kaspi\DiContainer\DefinitionsLoader;
use Kaspi\DiContainer\DiContainerFactory;

$loader = new DefinitionsLoader();

// üö© –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
$loader->load(

    __DIR__.'/config/base_services.php',

    __DIR__.'/config/prod_services.php'

);

if ('dev' === \getenv('APP_ENV')) {
    // üö© –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ä–∞–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    $loader->loadOverride(
    
        __DIR__.'/config/dev_services.php'
    
    );
}

$container = (new DiContainerFactory())->make(
    $loader->definitions()
);

$container->get(App\Services\ReportMaker::class); // –ø–æ–ª—É—á–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
```

## –ò–º–ø–æ—Ä—Ç –∫–ª–∞—Å—Å–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.
–ò–º–ø–æ—Ä—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–æ–≤ –∏ –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å —É—á—ë—Ç–æ–º PHP –∞—Ç—Ä–∏–±—É—Ç–æ–≤.
–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–æ–≤ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —É—á—ë—Ç–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω (_namespace_).

–¢–∞–∫–∞—è –æ–ø—Ü–∏—è –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ php-–∞—Ç—Ä–∏–±—É—Ç—ã.

–¢–∞–∫ –∂–µ –∏–º–ø–æ—Ä—Ç –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–µ–Ω –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É
`$useZeroConfigurationDefinition = false` ‚Äì [–∑–∞–ø—Ä–µ—â–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—Ç—å
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∞](https://github.com/agdobrynin/di-container/tree/main?tab=readme-ov-file#%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-dicontainer)
–µ—Å–ª–∏ –æ–Ω —è–≤–Ω–æ –Ω–µ –æ–±—ä—è–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

**–ú–µ—Ç–æ–¥ –∏–º–ø–æ—Ä—Ç–∞:**
```php
Kaspi\DiContainer\DefinitionsLoader::import(
    string $namespace,
    string $src,
    array $excludeFilesRegExpPattern = [],
    array $availableExtensions = ['php'],
    bool $useAttribute = true 
)
```
–ê—Ä–≥—É–º–µ–Ω—Ç—ã:
- `$namespace` ‚Äì –ø—Ä–µ—Ñ–∏–∫—Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç
–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª–∞—Å—Å (_–Ω–∞–ø—Ä–∏–º–µ—Ä: `'App\\'` ‚Äì –∑–∞–≥—Ä—É–∂–∞—Ç—å –µ—Å–ª–∏ namespace –∫–ª–∞—Å—Å–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞_);
- `$src` ‚Äì –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–ª–∞—Å—Å—ã;
- `$excludeFilesRegExpPattern` ‚Äì –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª—ã –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é;
- `$availableExtensions` ‚Äì —É–∫–∞–∑–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É —Ñ–∞–π–ª–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã;
- `$useAttribute` ‚Äì –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PHP –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤ —Å–µ—Ä–≤–∏—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

> [!TIP]
> –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `import`:

```php
use Kaspi\DiContainer\DefinitionsLoader;
use Kaspi\DiContainer\DiContainerFactory;

$loader = new DefinitionsLoader();

// üö© –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
$loader->load(

    __DIR__.'/config/base_services.php',

    __DIR__.'/config/prod_services.php'

);

if ('dev' === \getenv('APP_ENV')) {

    $loader->loadOverride(__DIR__.'/config/dev_services.php');

}

$loader->import(
    namespace: 'App\\',
    src: __DIR__.'/src/',
    excludeFilesRegExpPattern: [
        '#/src/Events/#',
        '#/src/config/.+\.php$#',
        '#src/(Kernel|Container)\.php$#',
    ]
)

$container = (new DiContainerFactory())->make(
    $loader->definitions()
);
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Å–æ–≤.
–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —á–µ—Ä–µ–∑ `DefinitionsLoader::import()`.
–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ `$importCacheFile`:
```php
DefinitionsLoader::__construct(
    ?string $importCacheFile = null,
    ?ImportLoaderCollectionInterface $importLoaderCollection = null
)
```
–ê—Ä–≥—É–º–µ–Ω—Ç:
- `$importCacheFile` ‚Äì –∏–º—è –∫—ç—à-—Ñ–∞–π–ª–∞.
- `$importLoaderCollection` ‚Äì –∫–ª–∞—Å—Å —Å–æ–±–∏—Ä–∞—é—â–∏–π fully qualified names –¥–ª—è php –∫–ª–∞—Å—Å–æ–≤ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.

> [!WARNING]
> –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ "development"
> –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (_–ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ_) —Ç–∞–∫ –∫–∞–∫ —Ñ–∞–π–ª –∫—ç—à–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –µ–¥–∏–Ω–æ–∂–¥—ã –∏ –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
> –≤ —Ä–∞–Ω–µ–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è.

–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à-—Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π:
```php
use Kaspi\DiContainer\DefinitionsLoader;

$loader = 'prod' === \getenv('APP_ENV'))
    ? new DefinitionsLoader(importCacheFile: __DIR__.'/../var/cache/def_import.php')
    : new DefinitionsLoader();
```
> [!TIP]
> –ß—Ç–æ –±—ã –∑–∞–Ω–æ–≤–æ —Å–æ–∑–¥–∞—Ç—å –∫—ç—à-—Ñ–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
> –≤—Ä—É—á–Ω—É—é —É–¥–∞–ª–∏—Ç—å —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ `$importCacheFile` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞ `DefinitionsLoader`.
